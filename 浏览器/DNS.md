## DNS

> Domain Name System 服务， 提供域名到IP地址之间的解析服务，与HTTP同属于应用层，若按照OSI7层结构模型，其属于应用层上的会话层。

> 基本流程： 当一个主机中的进程需要把[域名解析](https://cloud.tencent.com/product/cns?from=10680)为 IP 地址时，该进程就会调用解析程序，并成为 DNS 的 一个客户，把待解析的域名放在 DNS 的请求报中，以 UDP 用户数据报方式发送给本地域名服务器。本地域名服务器在查找域名后，把对应的 IP 地址放在回答报文中返回。获得 IP 地址的后主机即可进行通信。
>
> 总结：  域名解析时，以UDP的传输方式发起DNS请求报文到本地域名服务器， 本地域名服务器查找到域名后
>
> 把对应的IP地址放在回答报文中返回。 
>
> **本地域名服务器** ： 更精确指的是本地区的域名服务器，本地区的域名服务器一般由本地的网络服务提供商提供。 本地服务器保存着根域名服务器的NS记录和A记录

> DNS获取IP地址流程：
>
> ​        域名的制定规则：主机名.次级域名.顶级域名.根域名 
>
> ​                           例子： www.baidu.com.root    .root是根级域名，存在于所有域名上，因此默认省略
>
> ​                                                                                 .com是Top-level domain ，一般指明域名所在地区或者机构性质
>
> ​                                                                                 .baidu是Second-level domain，这一级域名用户可以自己注册
>
> ​                                                                                 .www是主机域名，用户在**自己的域**里面为服务器分配的名称，是可以**任意分配**。
>
> DNS服务器**根据域名的层级，进行分级查询**。每一级域名都有自己的NS记录，NS记录指向该级域名的域名服务器。这些服务器知道下一级域名的各种记录。
>
> 1. 从"根域名服务器"查到"顶级域名服务器"的NS记录和A记录（IP地址）
> 2. 从"顶级域名服务器"查到"次级域名服务器"的NS记录和A记录（IP地址）
> 3. 从"次级域名服务器"查出"主机名"的IP地址

## 根域名服务器

```
世界上一共有十三组根域名服务器，一共有13个组织进行管理，从A.ROOT-SERVERS.NET一直到M.ROOT-SERVERS.NET，TTL时间1000小时
即每1000小时才会进行重新查询。

本地服务器会内置的根域名服务器IP地址，DNS服务器向所有这些IP地址发出查询请求，询math.stackexchange.com的顶级域名服务器com.的NS记录。最先回复的根域名服务器将被缓存，以后只向这台服务器发请求。
```

## DNS查询过程

```
主机采用递归查询的方式向本地区服务器发送DNS查询报文，报文携带待查询的域名。本地区服务器会首先在缓存中
查找该域名对应的IP地址，若无则采用迭代的方式依次向根域名服务器、顶级域名服务器、权限域名服务器进行查询。

1. 递归查询：本机向本地域名服务器发出一次查询请求，就静待最终的结果。如果本地域名服务器无法解析，自己会以 DNS 客户机的身份向其它域名服务器查询，直到得到最终的 IP 地址告诉本机。
2. 迭代查询：本地域名服务器向根域名服务器查询，根域名服务器告诉它下一步到哪里去查询，然后它再去查，每次它都是以客户机的身份去各个服务器查询。

递归查询时，返回的结果只有两种:查询成功或查询失败.
迭代查询，又称作重指引,返回的是最佳的查询点或者主机地址.
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200423225313496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ptaWxr,size_16,color_FFFFFF,t_70)

## DNS缓存

> 浏览器、操作系统、本地区服务器都存在DNS缓存，当需要获取IP地址时，首先在浏览器的缓存中查看，无就去操作系统的host文件中进行查看，无的话向本地区服务器进行递归查询，本地服务器也会查看自己的缓存中是否有对应映射